\section{Метод компенсации нелинейных искажений на приемнике}
Компенсация нелинейных искажений сигнала является важным этапом для
сохранения производительности системы. С расширением стандарта связи 5G NR
в миллиметровый диапазон, компенсация становится особенно актуальной,
поскольку характеристики усилителей в этом диапазоне значительно хуже, чем
для более низких частот.


\subsection{Краткое описание архитектуры LLS системы мобильной связи 5G NR}

Для исследования влияния нелинейности УМ в диапазонах частот 30-70 ГГц и
100-200 ГГц, а также проверки работоспособности разработанного метода
компенсации нелинейных искажений на приемнике, в работе использовался
полноценный симулятор канального уровня LLS (\textit{Англ. - Link Level
Simulator}), соответствующий требованиям стандарта 5G NR 3GPP. В этой части
работы будут кратко описаны принципы работы, архитектура и основные
составляющие LLS. 

На рис. \ref{fig:lls_scheme} приведена принципиальная схемы работы LLS.
\begin{figure}[h!]
    \centering
    \includegraphics[width=0.95\linewidth]{figs/lls_scheme_cut.png}
    \caption{Принципиальная схема работы симулятора канального уровня LLS}
    \label{fig:lls_scheme}
\end{figure}

Симулятор включает в себя базовую обработку на передатчике (1), которая
может включать MIMO прекодинг и transform прекодинг (в случае использования
DFT-s-OFDM сигнала), а также стандартного для OFDM сигнала блока обратного
преобразования Фурье (IDFT/IFFT). Сгенерированный OFDM сигнал подается на
одну или более передающих цепочек, которые могут включать добавление
цикличного префикса, перенос сигнала на несущую частоту, и, наконец, сигнал
подается на усилитель мощности (2), работающий на несущей частоте. После
прохождения через канал, сигнал попадает на приемную цепь состоящую из
одной или нескольких приемных антенн (3) для дальнейшей обработки (4),
которая может состоять из преобразования Фурье, MRC и частотного
выравнивания. Такая обработка эффективно нивелирует влияние
частотно-селективного канала.
Модели канала, используемые в LLS соответствуют моделям приведенным в
стандарте 5G NR.

% TBD




\subsection{Реализация нелинейных искажений в LLS и их влияние на качество приема}
% Тут надо написать вставить графики, как именно портится прием сигнала, на
% чем отражается. Ссылку на секцию в результатах, потому что там будут
% основные графики.

На момент исследования влияния нелинейностей на производительность системы,
в LLS отсутствовал нелинейный УМ, а именно, он считался идеальным. Для
оценки влияния нелинейности АХ, а также разработки метода компенсации была
поставлена задачи внедрения усилителя на основе модели Раппа в LLS.
Опишем алгоритм, реализующий искажение сигнала на основе параметров УМ.

Рассматривается сигнал после основной подготовки, после IFFT-преобразования
и сериализации. Обозначим комплексную амплитуду дискретного сигнала
$S_{in}[n]$ как
\begin{equation}
    S_{in}[n] = \abs{S_{in}[n]}\exp(i\phi[n]),\quad n \in[0, N-1],
\end{equation}
где $n$ - индекс, $N$ - количество отсчетов. Средняя мощность
$P_{in}$ такого сигнала может быть записана как 
\begin{equation}
    P_{in} = \frac{1}{RN}\sum_{n=0}^{N-1}S^2_{in} = \frac{\text{RMS}(S_{in})^2}{R},
\end{equation}
где $R$ - сопротивлением согласованной нагрузки(здесь и далее будем считать
что $R=50$ Ом). Прохождение сигнала через усилитель характеризуется
искажением его амплитуды и фазы в соответствии с \ref{eq:pa_distortion}, а
именно
\begin{equation}
    S_{out} = F_{PA}(S_{in}) = F_{AM/AM}(\abs{S_{in}}) \cdot \exp[i \phi[n] + F_{AM/PM}(\abs{S_{in}})],
\end{equation}
где $S_{out}$ - комплексная огибающая сигнала после усилителя, $F_{PA}$ -
функция преобразования сигнала усилителем.

Поскольку желательным является иметь определенный уровень
выходной мощности $\tilde{P}_{TX}$, усиливаемый сигнал нужно
предварительно подготовить. Требуется, чтобы мощность сигнала на выходе
усилителя $P_{out}$ соответствовала $P_{out} = \tilde{P}_{TX}$.
Для этого сигнал $S_{in}$ необходимо умножить на коэффициент $K_0$ такой,
чтобы выполнялось соотношение
\begin{equation}
    \displaystyle
    \text{RMS}(F_{PA}(K_0 \cdot S_{in}))^2 = \frac{R}{1000} 10^{\left(P^{dBm}_{TX} - OBO^{dB}\right)/10},
\end{equation}
где $P^{dBm}_{TX}$ - требуемая выходная мощность на усилителе в dBm,
$OBO^{dB}$ - желаемый отступ по уровню выходной мощности от $P^{dBm}_{TX}$,
причем $\tilde{P}^{dBm}_{TX} = P^{dBm}_{TX} - OBO^{dB}$.
После того как коэффициент $K_0$ определен доступным способом (в случае
этой работы, использовался подбор $K_0$, однако не исключено использование
закона распределения функции случайного аргумента), сигнал пропускается
через усилитель, и передается блоку канального распространения. Коэффициент
$K_0$ в данном случае определяет рабочую точку УМ.

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.49\linewidth]{figs/dfts_10dbm_obo0.png}
    \includegraphics[width=0.49\linewidth]{figs/dfts_10dbm_obo3.png}
    \caption{Демонстрация искажения созвездий на приемнике в результате
    использования нелинейного УМ с выходной мощностью 10 dBm в LLS. На левом
    графике $OBO=0$ dB, на правом - $OBO=3$ dB.}
    \label{fig:lls_rapp_distortions_10dbm}
\end{figure}

На приемнике, в результате внесенных изменений наблюдаются искажения
полученных созвездий на приемнике. Пример таких искажений в случае
использования сигнала DFT-s-OFDM при $P^{dBm}_{TX} = 10$ dBm, $OBO = 0,3$
dB, $SNR=30$ dB и использовании модуляции 64-QAM приведен на рис.
\ref{fig:lls_rapp_distortions_10dbm}. В качестве модели УМ использовалась
модель Раппа \ref{eq:Rapp}, с параметрами приведенными в
\ref{eq:rapp_p3070} в соответствии с \cite{nokia163314}.


Сравниваются созвездия при выключенном (идеальном) УМ — красные точки, и
при включенном УМ — синие кресты.
Искажения совпадают с теоретически ожидаемыми, наблюдается увеличение
общего разброса точек, а также централизованный сдвиг облаков в зависимости
от амплитуды модуляции — чем больше амплитуда, тем больше искажение.
Из приведенных графиков можно сделать вывод о прямом влиянии величины OBO
на степень искажения полученного сигнала. Чем меньше значение OBO, тем
ближе средняя мощность сигнала к точке насыщения, тем больше проявляется
нелинейность, и тем больше искажается сигнал.

Аналогичную картину можно наблюдать при увеличении значения
$P^{dBm}_{TX}$ до 12 dBm. Результирующие созвездия на приемнике приведены
на рис. \ref{fig:lls_rapp_distortions_12dbm}. 

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.49\linewidth]{figs/dfts_12dbm_obo0.png}
    \includegraphics[width=0.49\linewidth]{figs/dfts_12dbm_obo3.png}
    \caption{Демонстрация искажения созвездий на приемнике в результате
    использования нелинейного УМ с выходной мощностью 12 dBm в LLS. На левом
    графике $OBO=0$ dB, на правом - $OBO=3$ dB.}
    \label{fig:lls_rapp_distortions_12dbm}
\end{figure}

Искажение принимаемых созвездий приводит к ошибкам при декодировании
сигнала. В качестве метрики воспользуемся отношением битовых ошибок к числу
переданных битов $ BER = N^{bit}_{errors}/N^{bit}_{sent}$ (\textit{Англ. - Bit
Error Rate}). Например, в случае $P^{dBm}_{TX}=10$ dBm (рис.
\ref{fig:lls_rapp_distortions_10dbm}), для $OBO=0$ dB BER увеличивается с 0
до $9\cdot 10^{-4}$, для $OBO=3$ dB BER увеличивается с 0 до $1.16\cdot
10^{-5}$. 

В случае $P^{dBm}_{TX}=12$ dBm
(рис. \ref{fig:lls_rapp_distortions_12dbm}), для $OBO=0$ dB BER
увеличивается с 0 до $6.56\cdot 10^{-3}$, для $OBO=3$ dB BER
увеличивается с 0 до $2.87\cdot 10^{-4}$. 

Более подробный анализ влияния нелинейности на количество ошибок в
зависимости от SNR будет приведен в секции \ref{sec:results}.

Таким образом нелинейный усилитель вносит значительные искажения в
передаваемый сигнал, что значительно влияет на качество связи. Возникает
необходимость компенсации внесенных нелинейных искажений для улучшения
производительности системы. В следующих секциях будут описаны существующие
методы компенсации, а также предложен новый метод компенсации на приемнике.




\subsection{Обзор существующих решений}
На текущий момент были исследованы несколько основных подходов для
компенсации нелинейных искажений, они разделяются на два основных
направления — обработка на передатчике, либо приемнике.

\subsubsection{Обработка сигнала на передатчике}

Первый метод заключается в предварительном искажении сигнала перед
подачей на УМ на передатчике. Сигналу придаются свойства, которые
минимизируют влияние нелинейного искажения от УМ, эффективно "выпрямляя"
его АХ. Существует множество вариантов обработки для данного подхода,
однако многие из них имеют слабый эффект на общей производительности
системы, а подход с применением предварительного искажения сигнала имеет
низкую эффективность при низких значениях IBO, при которой достигается
максимальная эффективность усилителя \cite{sharath2015}
\cite{shabany2008} \cite{eda2001}. Также, использование PD на передатчике
нежелательно на малогабаритных устройствах, поскольку в таком случае
увеличивается сложность устройства, объем сигнальной обработки и энергопотребление.

\subsubsection{Обработка сигнала на приемнике}

Второй основной подход заключается в компенсации нелинейных искажений на
приемнике. Например, в работе \cite{maltsev2021} используется
статистическая обработка принятого сигнала для определения степени
искажения, на основе которой в дальнейшем производится компенсация. Многие
работы \cite[]{sharath2015, shabany2008,bhat2016,qi2010,gregorio2007,
bouhadda2015,drotar2010} рассматривают теоретический подход для компенсации
на приемнике в очень обобщенном случае. Несколько методов компенсации были
предложены для OFDM сигнала \cite[]{gregorio2007,bouhadda2015, drotar2010},
где влияние нелинейности представляется комплексным множителем, а также
Гауссовой шумовой компонентой. Основной задачей в таком случае является
определение параметров УМ (они могут быть как известны изначально, так и
определены с помощью пилотных сигналов) для компенсации нелинейного
искажения. Несколько методов были исследованы для сигнала SC с одной несущей
(\textit{Англ. - SC - Single Carrier}) \cite[]{sharath2015,
shabany2008,bhat2016, qi2010}, в частности использовалась обратная
характеристика УМ и последовательные методы Монте-Карло. В нескольких
случаях \cite[]{bhat2016, qi2010,gregorio2007}, значения параметров УМ
считаются известными на приемнике, что позволяет произвести компенсацию
искажения. В случаях, когда параметры УМ оцениваются, производительность
такая же либо хуже.

В данной работе описывается новый метод компенсации нелинейных искажений УМ на
приемнике с использованием обратной амплитудной характеристики. Информация
о параметрах и рабочей точке усилителя предполагается известной. Работа и
эффективность метода будет исследоваться на существующем симуляторе
LLS, необходимые изменения будут вноситься в код симулятора
как для внесения искажений, так и для их компенсации.





\subsection{Подход и описание нового метода компенсации
нелинейных искажений на приемнике}
В основе разработанного метода компенсации нелинейных искажений на
приемнике лежит использование обратной АХ усилителя. Параметры $G, V_{sat},
p$, необходимые для восстановления обратной характеристики считаются
известными. Помимо этих параметров, важно также знать рабочую точку УМ,
поскольку это напрямую влияет на степень искажения принятого сигнала.
Рабочая точка также считается известной, и определяется значениями $K_0,
\tilde{P}_{TX}, OBO$. Компенсация будет производиться в основном для
амплитудных искажений, поскольку фазовые искажения незначительны.

Принципиальный подход компенсации может быть описан следующим
образом:
\begin{enumerate}
    \item Принятый сигнал проходит через предварительную обработку в LLS
    (частотное выравнивание, MIMO-декодирование, перенос в частотную
    область)
    \item Полученный обработанный сигнал в частотной области переносится во
    временную область в соответствии с используемым типом сигнала.
    \subitem Transform precoding (в случае DFT-s-OFDM сигнала)
    \subitem IDFT-обработка для получения OFDM сигнала во временной области
    \item Полученный сигнал во временной области подается на блок
    компенсации (использующий обратную АХ усилителя на основе известных
    параметров и рабочей точки)
    \item Сигнал с компенсированными искажениями переводится в частотную
    область в соответствии с используемым типом сигнала
    \subitem IDFT-обработка для OFDM сигнала
    \subitem Обратный Transform precoding (в случае DFT-s-OFDM сигнала)
    \item Компенсированный сигнал подается на блок демодуляции
\end{enumerate}

Блок-схема разработанного метода компенсации для OFDM сигнала приведена на
рис. \ref{fig:ofdm_compensation_scheme}.

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.99\linewidth]{figs/ofdm_compensation_scheme.pdf}
    \caption{Принципиальная схема компенсации нелинейных искажений для CP-OFDM сигнала.}
    \label{fig:ofdm_compensation_scheme}
\end{figure}

\subsubsection{Компенсация с использованием обратной характеристики усилителя}
Опишем алгоритм компенсации для CP-OFDM сигнала,
модификация для DFT-s-OFDM сигнала будет описана в секции \ref{sec:apadt}.

Для компенсации нелинейных искажений важно понимать как именно искажается
сигнал на передатчике. Перед подачей на УМ сигнал, сформированный в
частотной области, преобразуется в OFDM сигнал во временной области
посредством IFFT (см. рис. \ref{fig:ofdm_scheme}). После этого OFDM сигнал
подается на УМ и далее на передающие антенны. Таким образом, искажение
сигнала происходит во временной области, следовательно, компенсация также
должна производиться во временной области. 

Поскольку в LLS сигнал после передачи проходит через частотно-селективный
канал, одним из первых шагов после приема сигнала является частотное выравнивание с
помощью опорных сигналов DMRS, помещенных в сигнал на этапе
подготовки перед передачей. Эти сигналы доступны в частотной области,
поэтому принятый OFDM сигнал проходит через блок DFT. Происходит перенос в
частотную область, где выполняется частотное выравнивание сигнала.
Компенсация искажений должна быть произведена во временной области.
Опишем более подробно предлагаемый алгоритм компенсации сигнала на
приемнике.

После предварительной обработки имеем комплексный сигнал $S^{FD, RX}_{in}$
в частотной области. $S^{FD, RX}_{in}$ - комплексная матрица $M\times N_s$.
$M$ - ближайшая степень двойки к числу $N^{SC} = N^{SC}_{PRB} \cdot
N_{RB}$, где $N^{SC}_{PRB}$ - число поднесущих на ресурсный блок (PRB),
обычно $N^{SC}_{PRB}=12$, $N_{RB}$ - количество PRB, определяемое из
желаемой полосы BW. $N_s$ - количество OFDM сигналов, зависит от
моделируемого сигнала.

Для удобства, опишем операции DFT/IDFT для двумерных матриц. Пусть $X[a,b]$ -
матрица $A\times B$. Тогда IDFT по направлению с размерностью $A$ обозначим
как IDFT$_A$:
\begin{equation}
    x[a,b] = \text{IDFT}_{A}\left(X[a,b]\right) =\frac{1}{A}\sum^{A-1}_{k=0} X[k,b] \cdot e^{i 2 \pi k a/A}, a \in [0, A-1).
\end{equation}
Аналогично введем DFT$_A$:
\begin{equation}
    X[a,b] = \text{DFT}_{A}\left(x[a,b]\right) =\sum^{A-1}_{k=0} x[k,b] \cdot e^{-i 2 \pi k a/A}, a \in [0, A-1).
\end{equation}
% \begin{equation}
%     x_n = \frac{1}{N}\sum^{N-1}_{k=0} X_k \cdot e^{i 2 \pi k n/N}, n \in \mathbb{Z}
% \end{equation}

Для проведения операции компенсации необходимо перевести сигнал во временную
область, данная операция заключается в применении IDFT к матрице $S^{TD,
RX}_{in}$ по столбцам:
\begin{equation}
    S^{TD, RX}_{in}[m, n] = \text{IDFT}_{M}\left(S^{FD, RX}_{in}[m, n]\right),
    \label{eq:comp_ifft}
\end{equation}
где $S^{TD, RX}_{in}[m, n]$ - комплексная огибающая дискретного сигнала на
приемнике
\begin{equation}
    S^{TD, RX}_{in}[m,n] = \abs{S^{TD,RX}_{in}[m,n]}\exp(i\phi^{TD, RX}[m,n]),\quad n \in[0, N-1].
\end{equation}
Здесь $m \in [0, M-1],n \in [0, N_s-1]$ - индексы по поднесущим и OFDM
символам соответственно. Необходимо нормировать сигнал таким образом, чтобы
его средняя мощность на входе компенсатора $P^{TD, RX}_{in}$
соответствовала выходной мощности на усилителе $\tilde{P}_{TX}$, т.е.
\begin{equation}
    P^{TD, RX}_{in} = \frac{\text{RMS}\left(S^{TD, RX}_{in}\right)^2}{R} = \tilde{P}_{TX}.
\end{equation}
Для этого воспользуемся значениями $P_{TX}, OBO$, задающим рабочую точка
усилителя. Тогда нормированная огибающая $\hat{S}^{TD, RX}_{in}$ задается
следующим образом:
\begin{equation}
    \hat{S}^{TD, RX}_{in}[m, n] = \sqrt{\tilde{P}_{TX}R} \cdot
    \frac{S^{TD, RX}_{in}[m, n]}{\text{RMS}\left(S^{TD, RX}_{in}\right)}.
\end{equation}
Далее нормированный сигнал $\hat{S}^{TD, RX}_{in}$ подается на блок
компенсатора $F^{-1}_{AM/AM}$. Он представляет собой обратную амплитудную
характеристику УМ, полученую из модели Раппа \ref{eq:Rapp}, а именно
\begin{equation}
    \displaystyle
    F^{-1}_{AM/AM}(y) = 
       \frac{ y}{\left( 1 - \abs{\frac{y}{V_{sat}}}^{2p}\right)^{1/2p}},
    \label{eq:invRapp}
\end{equation}
где $y$ - сигнал на приемнике после переноса во временную область.
Тогда компенсированный сигнал $S^{TD, RX}_{out}$ может быть получен следующим образом:
\begin{equation}
    S^{TD, RX}_{out}[m, n] =
    \frac{1}{K_0}F^{-1}_{AM/AM}\left(\hat{S}^{TD, RX}_{in}[m, n]\right)
    \exp(i\phi^{TD, RX}[m, n]).
\end{equation}
Нормировка на $K_0$ необходима для того, чтобы привести сигнал к мощности,
которая подавалась на УМ до нормировки.
Далее, в соответствии с типом используемого сигнала (OFDM, DFT-s-OFDM),
необходимо произвести операцию, обратную \ref{eq:comp_ifft}. В случае OFDM
сигнала, необходимо провести DFT:
\begin{equation}
    S^{FD, RX}_{out}[m, n] = \text{DFT}_M\left(S^{TD, RX}_{out}[m, n]\right),
    \label{eq:ofdm_final_dft}
\end{equation}
где $S^{FD, RX}_{out}$ - результирующий компенсированный сигнал в частотной
области. 

Покажем работу разработанного метода компенсации на сигнале CP-OFDM.
Используем те же параметры, что и в случае демонстрации искажений в
результате реализации УМ в LLS (см. рис.
\ref{fig:lls_rapp_distortions_10dbm}. $P^{dBm}_{TX} = 10$ dBm, $OBO = 0$
dB, $SNR=30$ dB, 64-QAM модуляция). На рис.
\ref{fig:ofdm_lls_compensation_10dbm} приведены созвездия в случае
отсутствия компенсации, а также результат работы разработанного метода.
В случае идеального усилителя, BER составляет $5.46\cdot 10^{-5}$, при включении
нелинейного усилителя (модель 30-70 ГГц), BER увеличивается на два порядка
до $2.36\cdot 10^{-3}$. При использовании компенсации, BER понижается до
$3.85\cdot 10^{-4}$. Визуально наблюдается уменьшение разброса облаков
вокруг изначальных точек созвездия.

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.45\linewidth]{figs/ofdm_pa_on_obo0_TX10_noPN2.png}
    \includegraphics[width=0.45\linewidth]{figs/ofdm_pa_on_comp_obo0_TX10_noPN.png}
    \caption{Демонстрация работы разработанного метода компенсации на
    примере сигнала CP-OFDM. Слева приведено искаженное УМ созвездие (синие
    кресты), справа - искажения компенсированы. Красные точки обозначают
    неискаженные созвездия.}
    \label{fig:ofdm_lls_compensation_10dbm}
\end{figure}





\subsubsection{Адаптация алгоритма компенсации в зависимости от типа используемого сигнала}
\label{sec:apadt}
Модификация алгоритма для компенсации сигнала DFT-s-OFDM заключается в
обработке сигнала в соответствии с принципиальным подходом при генерации
данного сигнала. Блок схема компенсации для DFT-s-OFDM приведена на рис.
\ref{fig:dfts_compensation_scheme}. Схема отличается от рис.
\ref{fig:ofdm_compensation_scheme} добавлением двух блоков (обведены синим)
- K-DFT и K-IDFT.

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.99\linewidth]{figs/dfts_compensation_scheme.pdf}
    \caption{Принципиальная схема компенсации нелинейных искажений для
    DFT-s-OFDM сигнала. По сравнению со схемой на рис.
    \ref{fig:ofdm_compensation_scheme}, присутствуют два дополнительных
    блока Фурье преобразования (обведены синим).}
    \label{fig:dfts_compensation_scheme}
\end{figure}

Тогда, перед шагом \ref{eq:comp_ifft}, с сигналом необходимо провести K-DFT
преобразование, а именно
\begin{equation}
    S^{FD, RX}_{in}[m, n] = \sum^{N^{SC}+M_s-1}_{k=M_s} \hat{S}^{FD, RX}_{in}[k, n]
    \cdot e^{-\frac{i 2 \pi k m}{N^{SC}}}, m \in [M_s, N^{SC}+M_s-1], n \in [0, N_s],
    \label{eq:kdft_for_dftsofdm}
\end{equation}
где $\hat{S}^{FD, RX}_{in}$ - матрица сигнала $M\times N_s$ до
прекодирования, $M_s = \frac{M-N^{SC}}{2}$ - индекс начала поднесущих с
передаваемыми данными, $N^{SC}$ - общее количество поднесущих с данными.
В данном случае, K-DFT преобразование производится по поднесущим с данными,
т.е. $K = N^{SC}$. После этого дополнения, алгоритм повторяет
версию для OFDM сигнала с \ref{eq:comp_ifft} по \ref{eq:ofdm_final_dft} шаги,
после чего, в соответствии со схемой на рис.
\ref{fig:dfts_compensation_scheme} необходимо произвести K-IDFT
преобразование, по аналогии с \ref{eq:kdft_for_dftsofdm}:
\begin{equation}
    \hat{S}^{FD, RX}_{out}[m, n] = \frac{1}{N^{SC}}\sum^{N^{SC}+M_s-1}_{k=M_s} S^{FD, RX}_{out}[k, n]
    \cdot e^{\frac{i 2 \pi k m}{N^{SC}}}, m \in [M_s, N^{SC}+M_s-1], n \in [0, N_s],
    \label{eq:kidft_for_dftsofdm}
\end{equation}
где $\hat{S}^{FD, RX}_{out}$ - результирующий компенсированный сигнал в
частотной области для данного алгоритма.

Покажем работу разработанного метода компенсации на сигнале DFT-s-OFDM.
Используем те же параметры, что и в случае демонстрации искажений в
результате реализации УМ в LLS (см. рис.
\ref{fig:lls_rapp_distortions_10dbm}. $P^{dBm}_{TX} = 10$ dBm, $OBO = 0$
dB, $SNR=30$ dB, 64-QAM модуляция). Резльтат работы алгоритма компенсации
приведен на рис. \ref{fig:dfts_lls_compensation_10dbm}. Облака созвездий
сдвинулись ближе к своим изначальным точкам, а общий разброс стал меньше.

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.45\linewidth]{figs/dfts_10dbm_obo0_uncompensated.png}
    \includegraphics[width=0.45\linewidth]{figs/dfts_10dbm_obo0_compensated.png}
    \caption{Демонстрация работы разработанного метода компенсации (рис.
    \ref{fig:dfts_compensation_scheme}) на примере сигнала DFT-s-OFDM.
    Слева приведено искаженное УМ созвездие из рис.
    \ref{fig:lls_rapp_distortions_10dbm} , справа - искажения
    компенсированы.}
    \label{fig:dfts_lls_compensation_10dbm}
\end{figure}

В плане ошибок, в случае компенсации BER уменьшается на порядок с $9\cdot
10^{-4}$ до $9\cdot 10^{-5}$, что свидетельствует о корректной работе
алгоритма.



\subsubsection{Особенности использования обратной амплитудной
характеристики для компенсации нелинейных искажений}
В ходе исследований изначально использовалась обратная АХ УМ, приведенная в
\ref{eq:invRapp}. Усилитель по своей природе имеет свойство выходить на
насыщение после определенного уровня подаваемой мощности, т.е. после
определенного момента, в независимости от увеличения подаваемой мощности,
выходная мощность не будет расти. Это отражается в АХ в виде выхода на
уровень насыщения, связанного с параметром $V_{sat}$. При этом обратная
характеристика $F^{-1}_{AM/AM}$ стремится к бесконечности при приближении
входного значения к $V_{sat}$, т.е.:
\begin{equation}
    F^{-1}_{AM/AM}(y) \rightarrow \infty \eval_{y \rightarrow V_{sat}}
\end{equation}
Подобное поведение может привести к дополнительным искажениям
компенсируемого сигнала, что противоречит изначальной цели. OFDM сигнал
имеет высокое значение PAPR, поэтому при подаче на обратную характеристику
УМ \ref{eq:invRapp}, некоторые значения могут быть больше $V_{sat}$, что
невозможно физически. Этот эффект может привести к дополнительным
искажениям, пример таких искажений приведен на центральном графике рис.
\ref{fig:inf_distortion}.

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.32\linewidth]{figs/inv_rapp/dfts_no_comp.png}
    \includegraphics[width=0.32\linewidth]{figs/inv_rapp/dfts_inv_rapp_comp.png}
    \includegraphics[width=0.32\linewidth]{figs/inv_rapp/dfts_ceil_inv_rapp_comp.png}
    \caption{Результат применения обратной АХ \ref{eq:invRapp} и
    ограниченной обратной АХ \ref{eq:invCeiledRapp} к DFT-s-OFDM сигналу
    для компенсации. Черные точки отображают точки изначальное,
    передаваемое созвездие, синие точки обозначают значения созвездия
    принятого сигнала на приемнике. На графике слева компенсация
    отсутствует, по центру компенсация выполнена не ограниченной обратной
    АХ \ref{eq:invRapp}, справа ограничено обратной АХ
    \ref{eq:invCeiledRapp}. Поскольку на центральном графике обратная
    функция не ограничена, результирующее созвездие имеет дополнительно
    искажение в областях с высокой амплитудой. При ограничении
    обратной характеристики наблюдается необходимая компенсация и
    отсутствие дополнительных искажений.}
    \label{fig:inf_distortion}
\end{figure}

Таким образом важно произвести модификацию обратной характеристики,
ограничив ее значения при $y \geq V_{sat}$. В результате было получено
выражение, приведенное в \ref{eq:invCeiledRapp}. Сравнение результата
применения ограниченной и не ограниченной характеристик приведено на рис.
\ref{fig:inf_distortion}. 

В случае некомпенсированного сигнала, BER составляет $1.77\cdot 10^{-2}$.
При использовании не ограниченной обратной АХ \ref{eq:invRapp} для
компенсации BER составляет $1.29\cdot 10^{-2}$, а при ограничении обратной
АХ (\ref{eq:invCeiledRapp}), BER составляет $8.20 \cdot 10^{-3}$.
Ограничение функции улучшило результат почти в 1.5 раза, такой показатель
может быть критическим при низких значениях SNR.

\begin{equation}
    F^{-1}_{AM/AM}(y) = 
    \begin{cases}
        \displaystyle
       \frac{ y}{\left( 1 - \abs{\frac{y}{V_{sat}}}^{2p}\right)^{1/2p}}
       \quad y <\alpha V_{sat}\\
       \frac{ \alpha V_{sat}}{\left( 1 - \abs{\alpha}^{2p}\right)^{1/2p}}
       \quad y \geq \alpha V_{sat}
    \end{cases},
    \label{eq:invCeiledRapp}
\end{equation}

где $\alpha$ - граничный коэффициент, обеспечивающий ограничение функции
$F^{-1}_{AM/AM}$ от достижения бесконечности при $y \rightarrow V_{sat}$. В
ходе экспериментов со значениями, при $\alpha=0.9$ алгоритм показывает
наиболее оптимальный результат, сохраняя эффективность компенсации и не
создает дополнительных искажений. В дальнейшем в работе использовалась
именно ограниченная версия обратной АХ \ref{eq:invCeiledRapp}.
% No PN, PA On Uncoded BER: 1.77e-02 	Coded BER: 2.06e-02 	EVM: -15.30 dB
% No PN, PA On CeiledRapp Uncoded BER: 8.20e-03 	Coded BER: 6.59e-03 	EVM: -17.25 dB
% No PN, PA On Rapp Uncoded BER: 1.29e-02 	Coded BER: 1.77e-02 	EVM: -15.08 dB

В следующей главе \ref{sec:results} будут рассмотрены результаты работы алгоритма в различных
условиях и параметрах работы.



